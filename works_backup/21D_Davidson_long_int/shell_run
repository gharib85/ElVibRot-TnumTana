#!/bin/bash


###> parameters
##==============================================================

parall=MPI      ## MPI or openMP or BLANK
MPI_output0=1   ## just print output form process 0 in MPI, 0 for debug
num_cores=$1

LB=$2
LG=$3
B=$4

LBR=$5
LGR=$6
BR=$7

dav=$8
arpack=f


test=f
B=1
B2=2
x=4.5
zref=-1.4
pi=3.14159265358979323844
export EXTFextern=f90



if [ -z $LB -o -z $LG -o -z $LG ]; then
  echo 'short of variables, check shell input'
  exit 1
fi

##==============================================================
###< parameters


###> setup environment
##==============================================================

##--------------------------------------------------------------
## set code dir

here=`pwd`

work=$here/result/
DIR_vib=$here/../..
DIR_pot=$DIR_vib/sub_pot
VIBEXE=vib

cp sub_system_malo.f90 $DIR_pot/sub_system.f90

cd $DIR_vib
make

mkdir -p $work
cd $work

##--------------------------------------------------------------
## set working dir 

##TMPDIR=EVR-HenonHeiles_6D_LB$LB"-B"$B
##echo TMPDIR: $TMPDIR
 
name_WP=$work/"file_WPspectral_LB"$LB"_LG"$LG
name_WPR=$work/"file_WPspectral_LB"$LBR"_LG"$LGR
name_SaveWP=$work/file_WP

##--------------------------------------------------------------
## set openMP environment

if   [ $parall == 'openMP' ] ; then
  echo 'run with openMP'
  #export OMP_NUM_THREADS=$num_cores    ## number of openMP cores

## set MPI environment

elif [ $parall == 'MPI'    ] ; then
  echo 'run with MPI'
  MPI_cores=$num_cores                  ## number of MPI cores 

##  else
else
  echo 'run without openMP or MPI'
fi
##--------------------------------------------------------------

##==============================================================
###< environment


###> create file 'namelist' for parameters 
##==============================================================
##==============================================================
##==============================================================
cat > namelist << EOF
&system 
printlevel=1 
PGrid_omp=1 
POpPsi_omp=1 /

&constantes /

&variables nrho=0 Old_Qtransfo=f nb_Qtransfo=6 /

&Coord_transfo name_transfo='bunch_poly' nb_X=1 nat=9 /
   C   C   O   C   O   H   D   H   H    X
   1   2   3   4   5   6   7   8   9    10   # atom numbering

&dummyX tab_At_TO_X=3,5 type_dummyX='COM' /

&Coord_transfo name_transfo='poly' cos_th=t /
 &vector nb_vect=5 Frame=t iAtA=3 iAtB=5 / !O3->O5
 &vector iAtA=10 iAtB=1 /                  !X->C1
 &vector iAtA= 1 iAtB=6 /                  !C1->H6
 &vector iAtA=10 iAtB=7 cart=t /           !X->H7 (proton transfert)
 &vector nb_vect=1 Frame=t iAtA=4 iAtB=5 / !C4->O5
 &vector iAtA= 4 iAtB=8 /                  !C4->H8
 &vector nb_vect=1 Frame=t iAtA=2 iAtB=3 / !C2->O3
 &vector iAtA= 2 iAtB=9 /                  !C2->H9

&Coord_transfo name_transfo='oneD' nb_transfo=9 /
 &oneD iQin= 3 name_oneD='74' cte(1)=1.0 /
 &oneD iQin= 5 name_oneD='74' cte(1)=1.0 /
 &oneD iQin=12 name_oneD='74' cte(1)=1.0 /
 &oneD iQin=14 name_oneD='74' cte(1)=1.0 /
 &oneD iQin=18 name_oneD='74' cte(1)=1.0 /
 &oneD iQin=20 name_oneD='74' cte(1)=1.0 /
 &oneD iQin=13 name_oneD='affine' cte(1:2)=1.,$pi /
 &oneD iQin=15 name_oneD='affine' cte(1:2)=1.,$pi /
 &oneD iQin=19 name_oneD='affine' cte(1:2)=1.,$pi /

&Coord_transfo name_transfo='linear' /
sym  z   R1  R2  u2  R3  u3  f3  x   y   R1+  R2+  u2+  a+   ub+  g+   R1-  R2-  u2-  a-   ub-  g-
21
 1   0.  1.  0.  0.  0.  0.  0.  0.  0.  0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.
 2   0.  0.  1.  0.  0.  0.  0.  0.  0.  0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.
 3   0.  0.  0.  1.  0.  0.  0.  0.  0.  0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.
 4   0.  0.  0.  0.  1.  0.  0.  0.  0.  0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.
 5   0.  0.  0.  0.  0.  1.  0.  0.  0.  0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.
 6   0.  0.  0.  0.  0.  0.  1.  0.  0.  0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.
 7   0.  0.  0.  0.  0.  0.  0.  1.  0.  0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.
 8   0.  0.  0.  0.  0.  0.  0.  0.  1.  0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.
 9   1.  0.  0.  0.  0.  0.  0.  0.  0.  0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.   0.
10   0.  0.  0.  0.  0.  0.  0.  0.  0.  1.   0.   0.   0.   0.   0.   1.   0.   0.   0.   0.   0.
11   0.  0.  0.  0.  0.  0.  0.  0.  0.  0.   1.   0.   0.   0.   0.   0.   1.   0.   0.   0.   0.
12   0.  0.  0.  0.  0.  0.  0.  0.  0.  0.   0.   1.   0.   0.   0.   0.   0.   1.   0.   0.   0.
13   0.  0.  0.  0.  0.  0.  0.  0.  0.  0.   0.   0.   1.   0.   0.   0.   0.   0.   1.   0.   0.
14   0.  0.  0.  0.  0.  0.  0.  0.  0.  0.   0.   0.   0.   1.   0.   0.   0.   0.   0.   1.   0.
15   0.  0.  0.  0.  0.  0.  0.  0.  0.  0.   0.   0.   0.   0.   1.   0.   0.   0.   0.   0.   1.
16   0.  0.  0.  0.  0.  0.  0.  0.  0.  1.   0.   0.   0.   0.   0.  -1.   0.   0.   0.   0.   0.
17   0.  0.  0.  0.  0.  0.  0.  0.  0.  0.   1.   0.   0.   0.   0.   0.  -1.   0.   0.   0.   0.
18   0.  0.  0.  0.  0.  0.  0.  0.  0.  0.   0.   1.   0.   0.   0.   0.   0.  -1.   0.   0.   0.
19   0.  0.  0.  0.  0.  0.  0.  0.  0.  0.   0.   0.   1.   0.   0.   0.   0.   0.  -1.   0.   0.
20   0.  0.  0.  0.  0.  0.  0.  0.  0.  0.   0.   0.   0.   1.   0.   0.   0.   0.   0.  -1.   0.
21   0.  0.  0.  0.  0.  0.  0.  0.  0.  0.   0.   0.   0.   0.   1.   0.   0.   0.   0.   0.  -1.

&Coord_transfo name_transfo='RPH' opt_transfo=1 /

&RPH step=1.e-4 diabatic_freq=t H0_sym=t purify_hess=t /
 1 21 21    21 21 21   21 21 21  21 21 21  21 21 21    21 21 21   21 21 21
 Qinact2n_sym 1 1 1  1 1 2  1 2   1 1 1 2 1 2   1 1 1 2 1 2

&Coord_transfo name_transfo='active' /
 1 1 1    1 1 1   1 1 1  1 1 1  1 1 1    1 1 1   1 1 1 

&minimum pot0=0. read_itQ0transfo=2 pot_itQtransfo=0 unit='bohr' /
R1_F(BF)                    4.873215
R2_F(BF)                    3.744908
u2_F(BF)                    0.005470
R3_F(BF)                    2.038028
u3_F(BF)                    0.014242
phi3_F(BF)                  0.000000
x4_F(BF)                   -0.663011
y4_F(BF)                    0.000000
z4_F(BF)                    $zref
R1_F(1,BF)                  2.332503
R2_F(1,BF)                  2.077414
u2_F(1,BF)                 -0.486305
alpha_F(1,BF)               $pi
ubeta_F(1,BF)               0.036951
gamma_F(1,BF)               $pi
R1_F(2,BF)                  2.496509
R2_F(2,BF)                  2.047324
u2_F(2,BF)                 -0.398611
alpha_F(2,BF)               $pi
ubeta_F(2,BF)              -0.086986
gamma_F(2,BF)               0.000000


&CurviRPH nb_pts=2 gradient=f /
 -0.688987
 -0.68898700000000002        4.8732150000000001        3.7449080000000001        5.4700545567537692E-003   2.0380280000000002        1.4242963040492284E-002   0.0000000000000000      -0.66301100000000002        0.0000000000000000        2.4145059999999994        2.0623689999999995      -0.47660291240095071        0.0000000000000000       -2.5119282687238301E-002   0.0000000000000000       -8.2002999999999826E-002   1.5045000000000197E-002  -5.4606462143606954E-002   0.0000000000000000        6.2087113819020601E-002   0.0000000000000000     
  1      0.319498     0.177155    -0.003202    -0.104552    -0.000259
  2      0.177155     0.327620     0.127186     0.281528    -0.000831
  3     -0.003202     0.127186     0.427299     0.267202     0.019583
  4     -0.104552     0.281528     0.267202     8.644729     0.006287
  5     -0.000259    -0.000831     0.019583     0.006287     0.370474
  6     -0.003636     0.000790     0.007331    -0.014913     0.000682
  7      0.000000     0.000000     0.000000     0.000000     0.000000
  8     -0.128337    -0.063026    -0.002715     0.001396     0.001666
  9      0.000000     0.000000     0.000000     0.000000     0.000000
 10     -0.005745    -0.148440    -0.355741    -0.370329    -0.018537
 11     -0.000492     0.011242    -0.014696    -0.012571     0.004086
 12     -0.003398     0.051067    -0.070552    -0.007256     0.001090
 13      0.000000     0.000000     0.000000     0.000000     0.000000
 14     -0.079891     0.183880     0.152615     5.758508     0.007278
 15      0.000000     0.000000     0.000000     0.000000     0.000000
 16     -0.074207     0.060186     0.075961     0.895710     0.003242
 17      0.007585     0.005925     0.000377    -0.058643     0.001891
 18     -0.010122    -0.000234     0.002073    -0.235587    -0.000929
 19      0.000000     0.000000     0.000000     0.000000     0.000000
 20      0.007610    -1.055981    -0.251853    -1.388381     0.026825
 21      0.000000     0.000000     0.000000     0.000000     0.000000

  1     -0.003636     0.000000    -0.128337     0.000000    -0.005745
  2      0.000790     0.000000    -0.063026     0.000000    -0.148440
  3      0.007331     0.000000    -0.002715     0.000000    -0.355741
  4     -0.014913     0.000000     0.001396     0.000000    -0.370329
  5      0.000682     0.000000     0.001666     0.000000    -0.018537
  6      0.225726     0.000000     0.000885     0.000000    -0.007015
  7      0.000000     0.088707     0.000000    -0.001005     0.000000
  8      0.000885     0.000000     0.140019     0.000000    -0.038112
  9      0.000000    -0.001005     0.000000     0.030739     0.000000
 10     -0.007015     0.000000    -0.038112     0.000000     1.550575
 11     -0.001971     0.000000    -0.001550     0.000000     0.062307
 12      0.003955     0.000000     0.013078     0.000000    -0.030156
 13      0.000000    -0.076547     0.000000     0.034726     0.000000
 14     -0.095195     0.000000    -0.070740     0.000000    -0.173979
 15      0.000000     0.012247     0.000000    -0.005887     0.000000
 16      0.111669     0.000000     0.024859     0.000000     0.149658
 17     -0.000646     0.000000     0.000918     0.000000     0.018748
 18      0.005840     0.000000    -0.009114     0.000000    -0.005061
 19      0.000000     0.026260     0.000000    -0.017979    -0.000000
 20      0.001247     0.000000     0.116439     0.000000     0.371784
 21      0.000000    -0.020149     0.000000     0.014598     0.000000

  1     -0.000492    -0.003398     0.000000    -0.079891     0.000000
  2      0.011242     0.051067     0.000000     0.183880     0.000000
  3     -0.014696    -0.070552     0.000000     0.152615     0.000000
  4     -0.012571    -0.007256     0.000000     5.758508     0.000000
  5      0.004086     0.001090     0.000000     0.007278     0.000000
  6     -0.001971     0.003955     0.000000    -0.095195     0.000000
  7      0.000000     0.000000    -0.076547     0.000000     0.012247
  8     -0.001550     0.013078     0.000000    -0.070740     0.000000
  9      0.000000     0.000000     0.034726     0.000000    -0.005887
 10      0.062307    -0.030156     0.000000    -0.173979     0.000000
 11      0.690431     0.007420     0.000000    -0.008654     0.000000
 12      0.007420     0.463909     0.000000    -0.009722     0.000000
 13      0.000000     0.000000     0.998331     0.000000    -0.072887
 14     -0.008654    -0.009722     0.000000     4.841032     0.000000
 15      0.000000     0.000000    -0.072887     0.000000     0.191356
 16      0.017111    -0.008696    -0.000000     0.301632     0.000000
 17     -0.039389     0.004432     0.000000    -0.082443     0.000000
 18      0.005854    -0.005396     0.000000    -0.313740     0.000000
 19      0.000000     0.000000    -0.103709     0.000000    -0.186714
 20     -0.103279    -0.466143     0.000000    -1.149711     0.000000
 21      0.000000     0.000000    -0.143051     0.000000    -0.015933

  1     -0.074207     0.007585    -0.010122     0.000000     0.007610
  2      0.060186     0.005925    -0.000234     0.000000    -1.055981
  3      0.075961     0.000377     0.002073     0.000000    -0.251853
  4      0.895710    -0.058643    -0.235587     0.000000    -1.388381
  5      0.003242     0.001891    -0.000929     0.000000     0.026825
  6      0.111669    -0.000646     0.005840     0.000000     0.001247
  7      0.000000     0.000000     0.000000     0.026260     0.000000
  8      0.024859     0.000918    -0.009114     0.000000     0.116439
  9      0.000000     0.000000     0.000000    -0.017979     0.000000
 10      0.149658     0.018748    -0.005061    -0.000000     0.371784
 11      0.017111    -0.039389     0.005854     0.000000    -0.103279
 12     -0.008696     0.004432    -0.005396     0.000000    -0.466143
 13     -0.000000     0.000000     0.000000    -0.103709     0.000000
 14      0.301632    -0.082443    -0.313740     0.000000    -1.149711
 15      0.000000     0.000000     0.000000    -0.186714     0.000000
 16      1.313062     0.054009    -0.062130     0.000000    -0.211322
 17      0.054009     0.689248     0.001381     0.000000    -0.020206
 18     -0.062130     0.001381     0.437346     0.000000    -0.015404
 19      0.000000     0.000000     0.000000     0.602578     0.000000
 20     -0.211322    -0.020206    -0.015404     0.000000     6.643425
 21      0.000000     0.000000     0.000000    -0.026064     0.000000

  1      0.000000
  2      0.000000
  3      0.000000
  4      0.000000
  5      0.000000
  6      0.000000
  7     -0.020149
  8      0.000000
  9      0.014598
 10      0.000000
 11      0.000000
 12      0.000000
 13     -0.143051
 14      0.000000
 15     -0.015933
 16      0.000000
 17      0.000000
 18      0.000000
 19     -0.026064
 20      0.000000
 21      0.149548
0.688987
  0.68898700000000002        4.8732150000000001        3.7449080000000001       -5.4700545567537692E-003   2.0380280000000002       -1.4242963040492284E-002   0.0000000000000000      -0.66301100000000002        0.0000000000000000        2.4145059999999994        2.0623689999999995      -0.47660291240095071        0.0000000000000000        2.5119282687238283E-002   0.0000000000000000        8.2003000000000270E-002  -1.5044999999999753E-002   5.4606462143606843E-002   0.0000000000000000        6.2087113819020608E-002   0.0000000000000000     
  1      0.319498    -0.177155     0.003202    -0.104552     0.000259
  2     -0.177155     0.327620     0.127186    -0.281528    -0.000831
  3      0.003202     0.127186     0.427299    -0.267202     0.019583
  4     -0.104552    -0.281528    -0.267202     8.644729    -0.006287
  5      0.000259    -0.000831     0.019583    -0.006287     0.370474
  6     -0.003636    -0.000790    -0.007331    -0.014913    -0.000682
  7      0.000000     0.000000     0.000000     0.000000     0.000000
  8      0.128337    -0.063026    -0.002715    -0.001396     0.001666
  9      0.000000     0.000000     0.000000     0.000000     0.000000
 10      0.005745    -0.148440    -0.355741     0.370329    -0.018537
 11      0.000492     0.011242    -0.014696     0.012571     0.004086
 12      0.003398     0.051067    -0.070552     0.007256     0.001090
 13      0.000000     0.000000     0.000000     0.000000     0.000000
 14     -0.079891    -0.183880    -0.152615     5.758508    -0.007278
 15      0.000000     0.000000     0.000000     0.000000     0.000000
 16     -0.074207    -0.060186    -0.075961     0.895710    -0.003242
 17      0.007585    -0.005925    -0.000377    -0.058643    -0.001891
 18     -0.010122     0.000234    -0.002073    -0.235587     0.000929
 19      0.000000     0.000000     0.000000     0.000000     0.000000
 20     -0.007610    -1.055981    -0.251853     1.388381     0.026825
 21      0.000000     0.000000     0.000000     0.000000     0.000000

  1     -0.003636     0.000000     0.128337     0.000000     0.005745
  2     -0.000790     0.000000    -0.063026     0.000000    -0.148440
  3     -0.007331     0.000000    -0.002715     0.000000    -0.355741
  4     -0.014913     0.000000    -0.001396     0.000000     0.370329
  5     -0.000682     0.000000     0.001666     0.000000    -0.018537
  6      0.225726     0.000000    -0.000885     0.000000     0.007015
  7      0.000000     0.088707     0.000000    -0.001005     0.000000
  8     -0.000885     0.000000     0.140019     0.000000    -0.038112
  9      0.000000    -0.001005     0.000000     0.030739     0.000000
 10      0.007015     0.000000    -0.038112     0.000000     1.550575
 11      0.001971     0.000000    -0.001550     0.000000     0.062307
 12     -0.003955     0.000000     0.013078     0.000000    -0.030156
 13      0.000000    -0.076547     0.000000     0.034726     0.000000
 14     -0.095195     0.000000     0.070740     0.000000     0.173979
 15      0.000000    -0.012247     0.000000     0.005887     0.000000
 16      0.111669     0.000000    -0.024859     0.000000    -0.149658
 17     -0.000646     0.000000    -0.000918     0.000000    -0.018748
 18      0.005840     0.000000     0.009114     0.000000     0.005061
 19      0.000000    -0.026260     0.000000     0.017979     0.000000
 20     -0.001247     0.000000     0.116439     0.000000     0.371784
 21      0.000000    -0.020149     0.000000     0.014598     0.000000

  1      0.000492     0.003398     0.000000    -0.079891     0.000000
  2      0.011242     0.051067     0.000000    -0.183880     0.000000
  3     -0.014696    -0.070552     0.000000    -0.152615     0.000000
  4      0.012571     0.007256     0.000000     5.758508     0.000000
  5      0.004086     0.001090     0.000000    -0.007278     0.000000
  6      0.001971    -0.003955     0.000000    -0.095195     0.000000
  7      0.000000     0.000000    -0.076547     0.000000    -0.012247
  8     -0.001550     0.013078     0.000000     0.070740     0.000000
  9      0.000000     0.000000     0.034726     0.000000     0.005887
 10      0.062307    -0.030156     0.000000     0.173979     0.000000
 11      0.690431     0.007420     0.000000     0.008654     0.000000
 12      0.007420     0.463909     0.000000     0.009722     0.000000
 13      0.000000     0.000000     0.998331     0.000000     0.072887
 14      0.008654     0.009722     0.000000     4.841032     0.000000
 15      0.000000     0.000000     0.072887     0.000000     0.191356
 16     -0.017111     0.008696     0.000000     0.301632     0.000000
 17      0.039389    -0.004432     0.000000    -0.082443     0.000000
 18     -0.005854     0.005396     0.000000    -0.313740     0.000000
 19      0.000000     0.000000     0.103709     0.000000    -0.186714
 20     -0.103279    -0.466143     0.000000     1.149711     0.000000
 21      0.000000     0.000000    -0.143051     0.000000     0.015933

  1     -0.074207     0.007585    -0.010122     0.000000    -0.007610
  2     -0.060186    -0.005925     0.000234     0.000000    -1.055981
  3     -0.075961    -0.000377    -0.002073     0.000000    -0.251853
  4      0.895710    -0.058643    -0.235587     0.000000     1.388381
  5     -0.003242    -0.001891     0.000929     0.000000     0.026825
  6      0.111669    -0.000646     0.005840     0.000000    -0.001247
  7      0.000000     0.000000     0.000000    -0.026260     0.000000
  8     -0.024859    -0.000918     0.009114     0.000000     0.116439
  9      0.000000     0.000000     0.000000     0.017979     0.000000
 10     -0.149658    -0.018748     0.005061     0.000000     0.371784
 11     -0.017111     0.039389    -0.005854     0.000000    -0.103279
 12      0.008696    -0.004432     0.005396     0.000000    -0.466143
 13      0.000000     0.000000     0.000000     0.103709     0.000000
 14      0.301632    -0.082443    -0.313740     0.000000     1.149711
 15      0.000000     0.000000     0.000000    -0.186714     0.000000
 16      1.313062     0.054009    -0.062130     0.000000     0.211322
 17      0.054009     0.689248     0.001381     0.000000     0.020206
 18     -0.062130     0.001381     0.437346     0.000000     0.015404
 19      0.000000     0.000000     0.000000     0.602578     0.000000
 20      0.211322     0.020206     0.015404     0.000000     6.643425
 21      0.000000     0.000000     0.000000     0.026064     0.000000

  1      0.000000
  2      0.000000
  3      0.000000
  4      0.000000
  5      0.000000
  6      0.000000
  7     -0.020149
  8      0.000000
  9      0.014598
 10      0.000000
 11      0.000000
 12      0.000000
 13     -0.143051
 14      0.000000
 15      0.015933
 16      0.000000
 17      0.000000
 18      0.000000
 19      0.026064
 20      0.000000
 21      0.149548

&basis_nD nb_basis=21 name="direct_prod"   L_SparseBasis=$LB L_SparseGrid=$LG SparseGrid_type=4 /
 &basis_nD iQdyn(1)= 1 name="Hm"  Q0=.0 scaleQ=$x L_TO_nq_A=2 L_TO_nq_B=4 /
 &basis_nD iQdyn(1)= 2 name="Hm"  L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 3 name="Hm"  L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 4 name="Hm"  L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 5 name="Hm"  L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 6 name="Hm"  L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 7 name="Hm"  L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 8 name="Hm"  L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 9 name="Hm"  L_TO_nq_A=1 L_TO_nq_B=$B2 /

 &basis_nD iQdyn(1)= 10 name="Hm" L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 11 name="Hm" L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 12 name="Hm" L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 13 name="Hm" L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 14 name="Hm" L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 15 name="Hm" L_TO_nq_A=1 L_TO_nq_B=$B2 /

 &basis_nD iQdyn(1)= 16 name="Hm" L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 17 name="Hm" L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 18 name="Hm" L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 19 name="Hm" L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 20 name="Hm" L_TO_nq_A=1 L_TO_nq_B=$B  /
 &basis_nD iQdyn(1)= 21 name="Hm" L_TO_nq_A=1 L_TO_nq_B=$B2 /
 &inactives /

##  Eq.2b for Type_HamilOp=10, 1 for Eq.2d
##  direct_KEO=t: calculate everytime K operator
&actives test=$test direct=4 Type_HamilOp=10 direct_KEO=t Save_MemGrid=f /

&analyse max_ene=200000. 'cm-1' print=f print_psi=0 davidson=$dav arpack=$arpack
         formatted_file_WP=f FilePsiVersion=1 name_file_spectralWP="$name_WP" /

## nb_WP: number of states keeped
&davidson nb_WP=2 max_it=100 max_WP=300 num_resetH=5
          all_lower_states=t max_Ene=1500. 'cm-1' NewVec_type=4
          read_WP=t read_listWP=f name_file_readWP="$name_WPR" formatted_file_readWP=t 
          name_file_saveWP="$name_SaveWP"
/

EOF
##==============================================================
##==============================================================
##==============================================================
###< parameter file




###> run
##==============================================================

output_file_name="res-poly-1Dtbis-RPH10-2new3_LB"$LB"_LG"$LG

##-openMP-------------------------------------------------------
if   [ $parall == 'openMP' ] ; then
  $DIR_vib/$VIBEXE > $work/$output_file_name"_"$num_cores"openMpcores"

##-MPI----------------------------------------------------------
elif [ $parall == 'MPI'    ] ; then

  if [ -z $MPI_cores ]; then
    echo 'short of MPI core number, check shell input'
    exit 1
  fi

##-if just output process 0-------------------------------------

  if [ $MPI_output0 == 1 ] ; then
    mpirun -np $MPI_cores $here/MPI_output_control $DIR_vib/$VIBEXE > $work/$output_file_name"_"$num_cores"MPIcores"
  else
    mpirun -np $MPI_cores $DIR_vib/$VIBEXE > $work/$output_file_name"_"$num_cores"MPIcores"
  fi

##-no parallel--------------------------------------------------
else 
  $DIR_vib/$VIBEXE > $work/$output_file_name
fi
##==============================================================
###< run


echo 'script finished'
